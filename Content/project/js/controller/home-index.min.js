$(document).ready(function(){function o(n,t,i,r,u){var f=this;f.loading=new LoadingViewModel;f.showLogin=ko.observable(i);f.showMenu=ko.observable(r);f.menu=new MenuViewModel;f.customer=new CustomerViewModel(u);f.monitor=new MonitorViewModel(n);f.setup=new SetupViewModel(n);f.owner=new OwnerViewModel;f.shopOnline=new ShopOnlineViewModel;f.setting=new SettingViewModel;f.settingAllDomain=new SettingAllDomainViewModel;f.summary=new SummaryViewModel;f.webreport=new WebReportViewModel(n);f.egiftcard=new EgiftCardViewModel;f.log=new LogViewModel(n);f.marketingService=new MarketingServiceViewModel;f.autoUpdate=new AutoUpdateViewModel;f.deliveryBilling=new DeliveryBillingViewModel;f.logOff=function(){var n=getObjFormAjax(cJsonAccountLogOff);location.replace(n)};f.isPopupVisible=ko.observable(!1)}function i(n,t,i,r){var u=$.ajax({url:n,async:ajax_async,cache:ajax_cache,type:ajax_type_post,data:t,timeout:ajax_timeout});u.done(function(n){var t;removeSpinButton(i);n.status&&k(i,n);r.showAlert&&(i==cfrmLogIn&&grecaptcha.reset(),t=new ObjAlert(i,n.message,n.status),t.getAlert())});u.fail(function(){removeSpinButton(i);i==cfrmMonitorSelectDate&&loadingShimmer(!1,cGridMonitor);var n=new ObjAlert(i,cError_Fail_TimeOut,!1);n.getAlert()})}function k(n,i){var e,o,h,s,f;switch(n){case cfrmLogIn:ko.mapping.fromJSON(i.obj,{},vmViewIndex.customer);v();_signalConnect&&$.connection.checkout.server.getShopOnline(t);vmViewIndex.showLogin(!1);vmViewIndex.showMenu(!0);break;case cfrmMonitorSelectDate:ko.mapping.fromJSON(i.obj,{},vmViewIndex.monitor.data);loadingShimmer(!1,cGridMonitor);break;case cfrmMonitorResend:resend(i);break;case cfrmSetUpDomain:i.transaction.toUpperCase()==cStatusAdd?(e=r(i.obj,i.transaction.toUpperCase()),e!=null&&$.connection.checkout.server.spDomainAdd(t,e)):i.transaction.toUpperCase()==cStatusUpdate&&(e=r(i.obj,i.transaction.toUpperCase()),e!=null&&$.connection.checkout.server.spDomainUpdate(t,e));modalHide(cModalSetup);break;case cfrmSetUpUsaEpaySearchDate:isEmpty(i.obj)||(f=JSON.parse(i.obj),f!=null&&ko.mapping.fromJSON(JSON.stringify(f),{},vmViewIndex.setup.dataSetUpUsaEpaySearchDateModal.data));break;case cfrmOwner:i.transaction.toUpperCase()==cStatusAdd?(o=u(i.obj,i.transaction.toUpperCase()),o!=null&&$.connection.checkout.server.spOwnerAdd(t,o)):i.transaction.toUpperCase()==cStatusUpdate&&i.obj.length>0&&(o=u(i.obj,i.transaction.toUpperCase()),o!=null&&$.connection.checkout.server.spOwnerUpdate(t,o));modalHide(cModalOwner);break;case cfrmChangePassword:vmViewIndex.customer.firstName(vmViewIndex.setting.dataModalChangePassword.firstName());vmViewIndex.customer.lastName(vmViewIndex.setting.dataModalChangePassword.lastName());vmViewIndex.setting.dataModalChangePassword.showPassword(!1);vmViewIndex.setting.dataModalChangePassword.currentPassword("");vmViewIndex.setting.dataModalChangePassword.newPassword("");vmViewIndex.setting.dataModalChangePassword.confirmPassword("");modalHide(cModalChangePassword);break;case cfrmCreateAccount:modalHide(cModalCreateAccount);resetCreateAccountViewModel();break;case cfrmWrUser:d(i.obj,i.transaction.toUpperCase());modalHide(cModalWrUser);resetWrUserViewModel();break;case cfrmWrUserRoleMap:g(i.obj,i.transaction.toUpperCase());modalHide(cModalWrUserRoleMap);resetWrUserRoleMapViewModel();break;case cfrmWrRoleMenuMap:nt(i.obj,i.transaction.toUpperCase(),i.id);modalHide(cModalWrRoleMenuMap);resetWrRoleMenuViewModel();break;case cfrmMonitorVoidTicket:h=JSON.parse(i.obj);updateVoidStatusTicketData(h);break;case cfrmGiftCer:tt(JSON.parse(i.obj),i.transaction.toUpperCase());modalHide(cModalEgiftCard);case cfrmGiftCerSearch:s=i.type.toUpperCase();s==cStatusSearch?(f=JSON.parse(i.obj),f!=null&&f.giftCer!=null&&f.giftCerAccount!=null&&f.giftCerTx!=null&&it(f.giftCer,f.giftCerAccount,f.giftCerTx)):s==cStatusResend&&modalHide(cModalEgiftCardSearch);case cfrmGiftCerSearchDate:s=i.type.toUpperCase();s==cStatusSearch?isEmpty(i.obj)||(f=JSON.parse(i.obj),f!=null&&rt(f)):s==cStatusResend&&modalHide(cModalEgiftCardSearchDate);break;case cfrmShopClose:h=JSON.parse(i.obj);val=i.txtValue;ut(h,val);break;case cfrmLogSelectStore:vmViewIndex.log.domainName(i.domainName);ko.mapping.fromJSON(i.obj,{},vmViewIndex.log.data);loadingShimmer(!1,cGridLog)}}function v(){loadingShimmer(!0,cGridOwner);loadingShimmer(!0,cGridEgiftCard);loadingShimmer(!0,cGridWrUser);loadingShimmer(!0,cGridWrRoleMenuMap);loadingShimmer(!0,cGridWrUserRoleMap);loadingShimmer(!0,cGridAutoUpdate);vmViewIndex.customer.isAccountant()&&loadingShimmer(!0,cGridDeliveryBilling);n(cJsonGetWrMenu);n(cJsonGetWrGroupMenu);n(cJsonGetWrCustomer);n(cJsonGetWrUser);n(cJsonGetWrRoleMenuMap);n(cJsonGetWrUserRoleMap);n(cJsonGetWrRole);n(cJsonMonitorGetShopOnline);n(cfrmSetUpGetData);n(cfrmOwnerGetData);n(cfrmAutoUpdateGetData);vmViewIndex.setting.dataModalChangePassword.email(vmViewIndex.customer.email());vmViewIndex.setting.dataModalChangePassword.firstName(vmViewIndex.customer.firstName());vmViewIndex.setting.dataModalChangePassword.lastName(vmViewIndex.customer.lastName())}function r(n,t){var r,i,u;if(t==cStatusAdd)return r=ko.mapping.fromJSON(n),i=ko.mapping.fromJS(r),vmViewIndex.setup.data.push(i),refreshGrid(cGridMonitor),vmViewIndex.owner.dataModal.store.insert(i),y(i),i.domainId();if(t==cStatusUpdate){var r=ko.mapping.fromJSON(n),i=ko.mapping.fromJS(r),f=ko.utils.arrayFilter(vmViewIndex.setup.data(),function(n){return n.domainId()==i.domainId()});if(y(i),u=vmViewIndex.setup.data.indexOf(_.head(f)),u!=-1)return vmViewIndex.setup.data.replace(vmViewIndex.setup.data()[u],i),refreshGrid(cGridMonitor),i.domainId()}return null}function y(n){var t=[],i=n,r=i.productId(),u;r.length<=1?t.push(r):t=r.split(",");u=_.filter(t,function(n){return n=="3"});vmViewIndex.egiftcard.data.remove(function(n){return n.domainId()==i.domainId()});u.length>0&&vmViewIndex.egiftcard.data.push(i);refreshGrid(cGridEgiftCard)}function u(n,t){var r,i;if(t==cStatusAdd)return r=ko.mapping.fromJSON(n),i=_.head(r()),vmViewIndex.owner.data.push(i),refreshGrid(cGridOwner),i.customerId();if(t==cStatusUpdate){var r=ko.mapping.fromJSON(n),i=_.head(r()),f=ko.utils.arrayFilter(vmViewIndex.owner.data(),function(n){return n.customerId()==i.customerId()}),u=vmViewIndex.owner.data.indexOf(_.head(f));if(u!=-1)return vmViewIndex.owner.data.replace(vmViewIndex.owner.data()[u],i),refreshGrid(cGridOwner),i.customerId()}return null}function d(n,t){var r,i,f,u;return t==cStatusAdd?(r=ko.mapping.fromJSON(n),i=r,i.phone()!=null&&i.phone(i.phone().replace(/\D/g,"")),firebase.auth().createUserWithEmailAndPassword(i.email(),"WebReport123456").then(function(){firebase.auth().signInWithEmailAndPassword(i.email(),"WebReport123456").then(function(){var n=firebase.auth().currentUser;n.updateProfile({displayName:i.firstName()+" "+i.lastName()}).then(function(){p();vmViewIndex.webreport.dataUser.push(i);vmViewIndex.webreport.dataUserRoleMapModal.storeUser.insert(i);refreshGrid(cGridWrUser)}).catch(function(n){var t=n.code,i=n.message})}).catch(function(n){var t=n.code,i=n.message})}).catch(function(n){var t=n.code,i=n.message})):t==cStatusUpdate&&(r=ko.mapping.fromJSON(n),i=r,i.phone()!=null&&i.phone(i.phone().replace(/\D/g,"")),f=ko.utils.arrayFilter(vmViewIndex.webreport.dataUser(),function(n){return n.userId()==i.userId()}),u=vmViewIndex.webreport.dataUser.indexOf(_.head(f)),vmViewIndex.webreport.dataUserRoleMapModal.storeUser.update(i.userId(),i),u!=-1&&(vmViewIndex.webreport.dataUser.replace(vmViewIndex.webreport.dataUser()[u],i),refreshGrid(cGridWrUser))),null}function g(n,t){var i;if(t==cStatusAdd)i=ko.mapping.fromJSON(n),vmViewIndex.webreport.dataUserRoleMap.push(i),refreshGrid(cGridWrUserRoleMap);else if(t==cStatusUpdate){var i=ko.mapping.fromJSON(n),u=ko.utils.arrayFilter(vmViewIndex.webreport.dataUserRoleMap(),function(n){return n.userRoleMapId()==i.userRoleMapId()}),r=vmViewIndex.webreport.dataUserRoleMap.indexOf(_.head(u));r!=-1&&(vmViewIndex.webreport.dataUserRoleMap.replace(vmViewIndex.webreport.dataUserRoleMap()[r],i),refreshGrid(cGridWrUserRoleMap))}return null}function nt(n,t,i){var r;t==cStatusAdd?(r=ko.mapping.fromJSON(n),ko.utils.arrayForEach(r(),function(n){vmViewIndex.webreport.dataRoleMenuMap.push(n)}),refreshGrid(cGridWrRoleMenuMap)):(r=ko.mapping.fromJSON(n),vmViewIndex.webreport.dataRoleMenuMap.remove(function(n){return n.customerId()==i}),ko.utils.arrayForEach(r(),function(n){vmViewIndex.webreport.dataRoleMenuMap.push(n)}),refreshGrid(cGridWrRoleMenuMap))}function tt(n){var n,t,i;vmViewIndex.egiftcard.dataGiftCerModal.dataJoinDomain.removeAll();vmViewIndex.egiftcard.data.removeAll();ko.utils.arrayForEach(vmViewIndex.setup.data(),function(n){var t=[],i;n.productId().length<=1?t.push(n.productId()):t=n.productId().split(",");i=_.filter(t,function(n){return n=="3"});i.length>0&&vmViewIndex.egiftcard.data.push(n);i.length>0&&vmViewIndex.egiftcard.data.push(n.centreMapDomain)});n="";ko.utils.arrayForEach(vmViewIndex.egiftcard.data(),function(t){t!=undefined&&(n=n.length==0?t.domainId():n+","+t.domainId(),vmViewIndex.egiftcard.dataGiftCerModal.storeDomainData.insert(t))});t=JSON.parse(getObjFormAjax(cJsonGetWrEgiftCard,n));t.length>0&&(i=JSON.stringify(t),ko.mapping.fromJSON(i,{},vmViewIndex.egiftcard.dataGiftCer))}function it(n,t,i){ko.mapping.fromJSON(JSON.stringify(n),{},vmViewIndex.egiftcard.dataGiftCerSearchModal.dataGiftCer);ko.mapping.fromJSON(JSON.stringify(t),{},vmViewIndex.egiftcard.dataGiftCerSearchModal.dataGiftCerAccount);ko.mapping.fromJSON(JSON.stringify(i),{},vmViewIndex.egiftcard.dataGiftCerSearchModal.dataGiftCerTransaction);vmViewIndex.egiftcard.dataGiftCerSearchModal.search(!0);var r=vmViewIndex.egiftcard.dataGiftCerSearchModal.dataGiftCer().customerCode();vmViewIndex.egiftcard.dataGiftCerSearchModal.domainId(r)}function rt(n){ko.mapping.fromJSON(JSON.stringify(n.giftCerAccounts),{},vmViewIndex.egiftcard.dataGiftCerSearchDateModal.data);ko.mapping.fromJSON(JSON.stringify(n.orders),{},vmViewIndex.egiftcard.dataGiftCerSearchDateModal.dataEgiftCardOnly);ko.mapping.fromJSON(JSON.stringify(n.giftCerOrders),{},vmViewIndex.egiftcard.dataGiftCerSearchDateModal.dataGiftCerOrder)}function ut(n,t){var u=_.first(n),i=new DataShopCloseViewModel(n),r;t==cStatusAdd?vmViewIndex.setup.dataModal.dataShopClose.push(i):(r=ko.utils.arrayFilter(vmViewIndex.setup.dataModal.dataShopClose(),function(n){return n.time()[0].shopCloseId()==u.shopCloseIdFirst}),vmViewIndex.setup.dataModal.dataShopClose.replace(_.first(r),i));modalHide(cModalSetupShopClose);vmViewIndex.setup.dataModal.dataSetUpModalShopClose.clearSetUpShopClose()}function p(){var n=firebase.auth().currentUser;n&&firebase.auth().signOut().then(function(){}).catch(function(n){var t=n.code,i=n.message})}function ft(n,t){var i=new ObjUrl(n),r=i.getUrlFromJson(),u=JSON.parse('{"key" : "'+t+'"}');return getJsonFromAjax(r,!ajax_async,ajax_cache,ajax_type_post,u,ajax_timeout)}function e(n,t,i){var u=new ObjUrl(n),f=u.getUrlFromJson(),r;return isEmpty(i)||isEmpty(t)||(r=JSON.parse('{"domain" : "'+t+'", "key" : "'+i+'"}')),getJsonFromAjax(f,!ajax_async,ajax_cache,ajax_type_post,r,ajax_timeout)}function et(n,t,i){var u=new ObjUrl(n),f=u.getUrlFromJson(),r;return isEmpty(i)||isEmpty(t)||(r=JSON.parse('{"groupId" : "'+t+'", "key" : "'+i+'"}')),getJsonFromAjax(f,!ajax_async,ajax_cache,ajax_type_post,r,ajax_timeout)}function ot(n,t){var r=new ObjUrl(n),u=r.getUrlFromJson(),i;isEmpty(t)||(i=JSON.parse('{"date" : "'+t+'"}'));$.ajax({url:u,async:ajax_async,cache:ajax_cache,type:ajax_type_post,data:i,timeout:ajax_timeout}).done(function(n){n.status&&(data=n.obj,ko.mapping.fromJSON(data.Result,{},vmViewIndex.marketingService.data));loadingShimmer(!1,cGridMarketing)}).fail(function(){vmViewIndex.marketingService.data=null;loadingShimmer(!1,cGridMarketing)})}function n(n){var t=new ObjUrl(n),i=t.getUrlFromJson();fetch(i,{method:"POST",headers:{"Content-Type":"application/json"}}).then(ht).then(st).then(function(t){var r,i,u,o,s,f,h,e;switch(n){case cfrmSetUpGetData:r=ko.mapping.fromJSON(t.obj);ko.mapping.fromJS(r.domains,{},vmViewIndex.setup.data);_.forEach(r.timeZones(),function(n){vmViewIndex.setup.dataModal.store.insert(n)});setTimeout(function(){loadingShimmer(!1,cGridSetup)},0);vmViewIndex.customer.isAccountant()&&(_.forEach(r.domains(),function(n){n.dispatchTypeId()!=cDispatchType_None&&vmViewIndex.deliveryBilling.data.push(n)}),vmViewIndex.deliveryBilling.checkDataSourceFilter(),setTimeout(function(){loadingShimmer(!1,cGridDeliveryBilling)},0));_.forEach(vmViewIndex.setup.data(),function(n){vmViewIndex.owner.dataModal.store.insert(n)});_.forEach(vmViewIndex.setup.data(),function(n){vmViewIndex.monitor.store.insert(n)});_.forEach(vmViewIndex.setup.data(),function(n){vmViewIndex.log.store.insert(n)});vmViewIndex.egiftcard.data.removeAll();_.forEach(r.domains(),function(n){var t=[],i;n.productId().length<=1?t.push(n.productId()):t=n.productId().split(",");i=_.filter(t,function(n){return n=="3"});i.length>0&&vmViewIndex.egiftcard.data.push(n)});i="";ko.utils.arrayForEach(vmViewIndex.egiftcard.data(),function(n){i=i.length==0?n.domainId():i+","+n.domainId();vmViewIndex.egiftcard.dataGiftCerModal.storeDomainData.insert(n)});u=JSON.parse(getObjFormAjax(cJsonGetWrEgiftCard,i));u!=null&&u.length>0&&(o=JSON.stringify(u),ko.mapping.fromJSON(o,{},vmViewIndex.egiftcard.dataGiftCer),setTimeout(function(){loadingShimmer(!1,cGridEgiftCard)},0));break;case cJsonMonitorGetShopOnline:ko.mapping.fromJSON(t.obj,{},vmViewIndex.shopOnline.data);break;case cfrmOwnerGetData:var c=JSON.parse(t.obj),l=c.result,a=JSON.stringify(l);ko.mapping.fromJSON(a,{},vmViewIndex.owner.data);setTimeout(function(){loadingShimmer(!1,cGridOwner)},0);break;case cJsonGetWrCustomer:ko.mapping.fromJSON(t.obj,{},vmViewIndex.webreport.dataCustomer);_.forEach(vmViewIndex.webreport.dataCustomer(),function(n){vmViewIndex.webreport.dataUserRoleMapModal.storeCustomer.insert(n);vmViewIndex.webreport.dataRoleMenuModal.storeCustomer.insert(n)});break;case cJsonGetWrUser:ko.mapping.fromJSON(t.obj,{},vmViewIndex.webreport.dataUser);_.forEach(vmViewIndex.webreport.dataUser(),function(n){vmViewIndex.webreport.dataUserRoleMapModal.storeUser.insert(n)});setTimeout(function(){loadingShimmer(!1,cGridWrUser)},0);break;case cJsonGetWrRole:ko.mapping.fromJSON(t.obj,{},vmViewIndex.webreport.dataRole);_.forEach(vmViewIndex.webreport.dataRole(),function(n){vmViewIndex.webreport.dataUserRoleMapModal.storeRole.insert(n)});s=_.head(vmViewIndex.webreport.dataRole());vmViewIndex.webreport.rdoRoleSelectInRoleMenuMap(s.roleId());break;case cJsonGetWrGroupMenu:ko.mapping.fromJSON(t.obj,{},vmViewIndex.webreport.dataGroupMenu);break;case cJsonGetWrMenu:ko.mapping.fromJSON(t.obj,{},vmViewIndex.webreport.dataMenu);break;case cJsonGetWrRoleMenuMap:ko.mapping.fromJSON(t.obj,{},vmViewIndex.webreport.dataRoleMenuMap);setTimeout(function(){loadingShimmer(!1,cGridWrRoleMenuMap)},0);break;case cJsonGetWrUserRoleMap:ko.mapping.fromJSON(t.obj,{},vmViewIndex.webreport.dataUserRoleMap);setTimeout(function(){loadingShimmer(!1,cGridWrUserRoleMap)},0);break;case cfrmSummaryGetData:t.status?ko.mapping.fromJSON(t.obj,{},vmViewIndex.summary.data):swal(cSwal_Alert_Error,t.message,cSwal_Icon_Error);setTimeout(function(){loadingShimmer(!1,cGridSummary)},0);break;case cfrmAutoUpdateGetData:t.status&&(f=JSON.parse(t.obj),ko.mapping.fromJS(f.autoUpdate,{},vmViewIndex.autoUpdate.data),ko.mapping.fromJS(f.svn,{},vmViewIndex.autoUpdate.dataSettingSvnModal),h=ko.mapping.fromJS(f.version),e="",_.forEach(h(),function(n){n.major()!=e&&vmViewIndex.autoUpdate.dataUpdateVersionModal.storeVersion.insert(n);e=n.major()}));setTimeout(function(){loadingShimmer(!1,cGridAutoUpdate)},0);break;case cJsonMonitorGetData:ko.mapping.fromJSON(t.obj,{},vmViewIndex.monitor.data);setTimeout(function(){loadingShimmer(!1,cGridMonitor)},0)}}).catch(function(){swal(cSwal_Alert_Error,replaceNewLineToBr(n+" : request failed"),cSwal_Icon_Error)})}function st(n){return n.json()}function ht(n){if(n.status>=200&&n.status<300)return n;var t=new Error(n.statusText);t.response=n;throw t;}function ct(){setInterval(function(){getObjFormAjax(cJsonKeepSessionAlive,"")},9e5)}var t,c,b;$(".shimmer-monitor").hide();$(".shimmer-log").hide();$(".shimmer-summary").hide();$(".shimmer-marketing").hide();$(".shimmer-owner").hide();$(".shimmer-egiftcard").hide();$(".shimmer-webreport-user").hide();$(".shimmer-webreport-menu").hide();$(".shimmer-webreport-role").hide();$(".shimmer-autoupdate").hide();$(".shimmer-deliverybilling").hide();loadingShimmer(!0,cGridSetup);var f=$("#divVarAuthenticated").val(),s=$("#divVarCurrentDay").val(),h=$("#divVarCurrentDateTime").val();_currentTime=moment(h,moment_date_format_mmddyyyyhhmmssa);_currentDate=moment(h).format(moment_date_format_mmddyyyy);t=$("#divVarKey").val();t=t.substring(0,t.length-3);isEmpty(f)?vmViewIndex=new o(_currentDate,s,!0,!1,null):(c=ft(cJsonGetCustomer,f),vmViewIndex=new o(_currentDate,s,!1,!0,c),v());ko.applyBindings(vmViewIndex,document.getElementById("koMenuView"));Sammy(function(){this.get("#:view",function(t){switch(t.path){case"/#monitor":setDefaultMenu();vmViewIndex.menu.name("Monitor");vmViewIndex.menu.monitor(!0);toggleSlideMobile();break;case"/#setup":$(".shimmer-setup").css("display")=="none"&&loadingShimmer(!0,cGridSetup);getAllAccount();setDefaultMenu();vmViewIndex.menu.name("Setup");vmViewIndex.menu.setup(!0);toggleSlideMobile();break;case"/#owner":setDefaultMenu();vmViewIndex.menu.name("Owner");vmViewIndex.menu.owner(!0);toggleSlideMobile();break;case"/#webreport":setDefaultMenu();vmViewIndex.menu.name("Web Report");vmViewIndex.menu.webreport(!0);toggleSlideMobile();$(".slickWebReport").slick("setPosition");break;case"/#summary":loadingShimmer(!0,cGridSummary);n(cfrmSummaryGetData);setDefaultMenu();vmViewIndex.menu.name("Summary");vmViewIndex.menu.summary(!0);toggleSlideMobile();break;case"/#egiftcard":setDefaultMenu();vmViewIndex.menu.name("E-Gift Card");vmViewIndex.menu.egiftcard(!0);toggleSlideMobile();break;case"/#log":setDefaultMenu();vmViewIndex.menu.name("Log");vmViewIndex.menu.log(!0);toggleSlideMobile();break;case"/#autoupdate":setDefaultMenu();vmViewIndex.menu.name("Auto Update");vmViewIndex.menu.autoUpdate(!0);toggleSlideMobile();break;case"/#marketingService":setDefaultMenu();vmViewIndex.menu.name("MarketingService");vmViewIndex.menu.marketingService(!0);loadingShimmer(!0,cGridMarketing);ot(cfrmMarketingServiceGetData);toggleSlideMobile();break;case"/#deliveryBilling":setDefaultMenu();vmViewIndex.menu.name("DeliveryBilling");vmViewIndex.menu.deliveryBilling(!0);toggleSlideMobile()}})}).run("");$(".slickSetup").slick({arrow:!1,dots:!0,infinite:!1,touchMove:!1,swipe:!1,slidesToShow:1,slidesToScroll:1});$(".slickWebReport").slick({arrow:!1,dots:!0,infinite:!1,touchMove:!1,swipe:!1,slidesToShow:1,slidesToScroll:1});$(document).on("submit","form",function(){var o,s;if(!checkInternetConnection())return o=new ObjAlert(n,cError_Fail_NoInternet,!1),o.getAlert(),!1;var c=$(this),n=c.attr("id"),l=$(this).parent(),t=new ObjValidateForm(n,l),a=$(document.activeElement).val();if(t.verifyData(),t.error.length>0)return t.showAlert&&(s=convertArrToString(t.error),swal(cSwal_Alert_Error,replaceNewLineToBr(s),cSwal_Icon_Error)),!1;addSpinButton(n);var u=$(this).serialize(),v=new ObjUrl(n,a),r=v.getUrlSubmitForm();if(isEmpty(r))return swal(cSwal_Alert_Error,cError_Dev_Url,cSwal_Icon_Error),!1;if(cfrmSetUpDomain==n){var e=vmViewIndex.setup.dataModal.currentProductId(),f=vmViewIndex.setup.dataModal.productId(),h=!0;(e.includes("2")||e.includes("4"))&&(h=f.includes("2")||f.includes("4")?!0:!1);h?e!=f&&f!=""?swal({title:"Are you sure, you want to save?",type:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,closeOnCancel:!1,confirmButtonClass:"btn theme default-button",cancelButtonClass:"btn btn-danger"}).then(function(){i(r,u,n,t)},function(t){t==="cancel"&&removeSpinButton(n)}):i(r,u,n,t):swal(cSwal_Alert_Error,"Please select product Smile Dining or Smile Contactless Dining or Both.",cSwal_Icon_Error)}else n==cfrmMonitorSelectDate?(loadingShimmer(!0,cGridMonitor),i(r,u,n,t)):n==cfrmLogSelectStore?(loadingShimmer(!0,cGridLog),i(r,u,n,t)):i(r,u,n,t);return!1});if($("nav.nav-mobile").slideAndSwipe(),changeDateBoxOnMonitor(),$(window).resize(function(){changeDateBoxOnMonitor()}),typeof dcodeIO=="undefined"||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");try{var w=$("#protobuf-path").val(),l=dcodeIO.ProtoBuf,a=l.newBuilder({convertFieldsToCamelCase:!0});l.loadProtoFile(w,a);b=a.build();$.connection.hub.url=cGlobal_url;$.connection.hub.qs={groupId:"SUPPORT",application:cGlobal_application};try{$.connection.checkout.client.sendUpdateToMonitor=function(n,t){setAutoUpdate(n,t)}}catch(lt){}try{$.connection.checkout.client.sendRestaurantJustOnline=function(n){if(vmViewIndex.shopOnline.data().length!=0){var i=ko.utils.arrayFilter(vmViewIndex.shopOnline.data(),function(t){return t.domainId()==n}),t=vmViewIndex.shopOnline.data.indexOf(_.head(i));if(t!=-1)vmViewIndex.shopOnline.data()[t].online(!0)}}}catch(lt){}try{$.connection.checkout.client.sendRestaurantJustOffline=function(n){if(vmViewIndex.shopOnline.data().length!=0){var i=ko.utils.arrayFilter(vmViewIndex.shopOnline.data(),function(t){return t.domainId()==n}),t=vmViewIndex.shopOnline.data.indexOf(_.head(i));if(t!=-1){vmViewIndex.shopOnline.data()[t].online(!1);toastShopOffline(vmViewIndex.shopOnline.data()[t].domainName());playSound(cSoundOffline)}}}}catch(lt){}try{$.connection.checkout.client.sendRestaurantOnline=function(n){vmViewIndex.shopOnline.data().length!=0&&_.forEach(n,function(n){var i=ko.utils.arrayFilter(vmViewIndex.shopOnline.data(),function(t){return t.domainId()==n}),t=vmViewIndex.shopOnline.data.indexOf(_.head(i));if(t!=-1)vmViewIndex.shopOnline.data()[t].online(!0)})}}catch(lt){}try{$.connection.checkout.client.sendTicketToMonitor=function(n,t,i){var o,f,u,r;isToday()&&vmViewIndex.monitor.valueArrProduct()==products.cSmileDining&&vmViewIndex.monitor.domainId()==n&&(vmViewIndex.monitor.data().length==0?(u=e(cJsonMonitorGetData,n,t),r=_.head(ko.mapping.fromJSON(u)()),r.send(i),vmViewIndex.monitor.data.unshift(r)):(o=ko.utils.arrayFilter(vmViewIndex.monitor.data(),function(i){return i.ticketId()==t&&i.domainId()==n}),f=vmViewIndex.monitor.data.indexOf(_.head(o)),f!=-1?(vmViewIndex.monitor.data()[f].send(i),refreshGrid(cGridMonitor)):(u=e(cJsonMonitorGetData,n,t),r=_.head(ko.mapping.fromJSON(u)()),r.send(i),vmViewIndex.monitor.data.unshift(r))),playSound(cSoundReceive))}}catch(lt){}try{$.connection.checkout.client.sendTicketUpdateToMonitor=function(n,t){var r,i,u,f;isToday()&&vmViewIndex.monitor.valueArrProduct()==products.cSmileDining&&vmViewIndex.monitor.domainId()==n&&vmViewIndex.monitor.data().length>0&&(r=ko.utils.arrayFilter(vmViewIndex.monitor.data(),function(i){return i.ticketId()==t&&i.domainId()==n}),i=vmViewIndex.monitor.data.indexOf(_.head(r)),i!=-1&&(u=e(cJsonMonitorGetData,n,t),f=_.head(ko.mapping.fromJSON(u)()),vmViewIndex.monitor.data.replace(vmViewIndex.monitor.data()[i],f),refreshGrid(cGridMonitor)))}}catch(lt){}try{$.connection.checkout.client.sendConfirmTicketToMonitor=function(n,t){if(isToday()&&vmViewIndex.monitor.data().length>0){var r=ko.utils.arrayFilter(vmViewIndex.monitor.data(),function(i){return i.ticketId()==t&&i.domainId()==n}),i=vmViewIndex.monitor.data.indexOf(_.head(r));i!=-1&&(vmViewIndex.monitor.data()[i].confirm(!0),refreshGrid(cGridMonitor))}}}catch(lt){}try{$.connection.checkout.client.sendVoidToMonitor=function(n,t){if(isToday()&&vmViewIndex.monitor.data().length>0){var r=ko.utils.arrayFilter(vmViewIndex.monitor.data(),function(i){return i.ticketId()==t&&i.domainId()==n}),i=vmViewIndex.monitor.data.indexOf(_.head(r));i!=-1&&(vmViewIndex.monitor.data()[i].ticketStatus("V"),refreshGrid(cGridMonitor))}}}catch(lt){}try{$.connection.checkout.client.spSendDomainAdd=function(n){var t=getObjFormAjax(cfrmSetUpGetDataByKey,n);r(t,cStatusAdd)}}catch(lt){}try{$.connection.checkout.client.spSendDomainUpdate=function(n){var t=getObjFormAjax(cfrmSetUpGetDataByKey,n);r(t,cStatusUpdate)}}catch(lt){}try{$.connection.checkout.client.spSendOwnerAdd=function(n){var t=getObjFormAjax(cfrmOwnerGetDataByKey,n);u(t,cStatusAdd)}}catch(lt){}try{$.connection.checkout.client.spSendOwnerUpdate=function(n){var t=getObjFormAjax(cfrmOwnerGetDataByKey,n);u(t,cStatusUpdate)}}catch(lt){}try{$.connection.checkout.client.returnIncompleteSendOrder=function(n,t){et(cJsonSendFail,n,t)}}catch(lt){}$.connection.hub.start({transport:["longPolling"]}).done(function(){_signalConnect=!0;$.connection.checkout.server.joinGroup(t,"SUPPORT");isEmpty(f)||$.connection.checkout.server.getShopOnline(t);console.log("connection started!")}).fail(function(){_signalConnect=!1;console.log("Could not Connect!")});$.connection.hub.disconnected(function(){setTimeout(function(){$.connection.hub.start()},5e3)});$.connection.hub.stateChanged(function(n){n.newState===$.signalR.connectionState.reconnecting?(_signalConnect=!1,console.log("Server is unreachable, trying to reconnect...")):n.newState===$.signalR.connectionState.connected&&(_signalConnect=!0,console.log("Server reconnected, reinitialize"))})}catch(lt){console.log("error servermaintenace")}setMaskPhone();setGeoLocation();p();ct();setTimeout(function(){$("body").addClass("loaded");$(".viewLoading").removeClass("gb_hidden");var n=checkVersionIE();isEmpty(n)||n<11&&$("#browserVerionModel").modal("show")},1e3)});